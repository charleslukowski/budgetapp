{% extends "base.html" %}

{% block title %}System Coal Inventory - {{ year }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-left">
        <h1>System Coal Inventory <span class="subtitle">Combined Plants</span></h1>
    </div>
    <div class="header-right">
        <span class="card-subtext">Year: {{ year }}</span>
    </div>
</div>

<!-- System Summary Bar (compact like Budget View) -->
<div class="budget-summary">
    <div class="summary-item highlight">
        <span class="label">Total Supply</span>
        <span class="value">{{ "{:,.0f}".format(system.total_tons) }} tons</span>
    </div>
    <div class="summary-item highlight">
        <span class="label">Total Cost</span>
        <span class="value">${{ "{:,.0f}".format(system.total_cost) }}</span>
    </div>
    <div class="summary-item">
        <span class="label">Avg $/Ton</span>
        <span class="value">${{ "{:.2f}".format(system.avg_cost_per_ton) }}</span>
    </div>
    <div class="summary-item">
        <span class="label">Kyger Days Supply</span>
        <span class="value">{{ kyger.avg_days_supply|round(0)|int }} avg</span>
    </div>
    <div class="summary-item">
        <span class="label">Clifty Days Supply</span>
        <span class="value">{{ clifty.avg_days_supply|round(0)|int }} avg</span>
    </div>
</div>

<!-- Monthly System Coal Supply Table -->
<h2 class="section-title">Monthly Coal Supply</h2>
<div class="grid-container" style="overflow-x: auto;">
    <table class="data-grid">
        <thead>
            <tr>
                <th></th>
                {% for m in monthly_data %}
                <th class="align-right">{{ m.month_name[:3] }}</th>
                {% endfor %}
                <th class="align-right total-col">Annual</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Kyger Deliveries</td>
                {% for m in monthly_data %}
                <td class="align-right">{{ "{:,.0f}".format(m.kyger_deliveries) }}</td>
                {% endfor %}
                <td class="align-right total-col">{{ "{:,.0f}".format(kyger.total_tons) }}</td>
            </tr>
            <tr>
                <td>Clifty Deliveries</td>
                {% for m in monthly_data %}
                <td class="align-right">{{ "{:,.0f}".format(m.clifty_deliveries) }}</td>
                {% endfor %}
                <td class="align-right total-col">{{ "{:,.0f}".format(clifty.total_tons) }}</td>
            </tr>
            <tr class="totals-row">
                <td><strong>System Total</strong></td>
                {% for m in monthly_data %}
                <td class="align-right" style="font-weight:600">{{ "{:,.0f}".format(m.system_deliveries) }}</td>
                {% endfor %}
                <td class="align-right total-col" style="font-weight:600">{{ "{:,.0f}".format(system.total_tons) }}</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Monthly Cost Table -->
<h2 class="section-title">Monthly Coal Costs</h2>
<div class="grid-container" style="overflow-x: auto;">
    <table class="data-grid">
        <thead>
            <tr>
                <th></th>
                {% for m in monthly_data %}
                <th class="align-right">{{ m.month_name[:3] }}</th>
                {% endfor %}
                <th class="align-right total-col">Annual</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Kyger Cost</td>
                {% for m in monthly_data %}
                <td class="align-right">${{ "{:,.0f}".format(m.kyger_cost) }}</td>
                {% endfor %}
                <td class="align-right total-col">${{ "{:,.0f}".format(kyger.total_cost) }}</td>
            </tr>
            <tr>
                <td>Clifty Cost</td>
                {% for m in monthly_data %}
                <td class="align-right">${{ "{:,.0f}".format(m.clifty_cost) }}</td>
                {% endfor %}
                <td class="align-right total-col">${{ "{:,.0f}".format(clifty.total_cost) }}</td>
            </tr>
            <tr class="totals-row">
                <td><strong>System Total</strong></td>
                {% for m in monthly_data %}
                <td class="align-right" style="font-weight:600">${{ "{:,.0f}".format(m.system_cost) }}</td>
                {% endfor %}
                <td class="align-right total-col" style="font-weight:600">${{ "{:,.0f}".format(system.total_cost) }}</td>
            </tr>
            <tr>
                <td><strong>System $/Ton</strong></td>
                {% for m in monthly_data %}
                <td class="align-right" style="font-weight:600">${{ "{:.2f}".format(m.system_cost_per_ton) if m.system_cost_per_ton else '-' }}</td>
                {% endfor %}
                <td class="align-right total-col" style="font-weight:600">${{ "{:.2f}".format(system.avg_cost_per_ton) }}</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Days Supply Table -->
<h2 class="section-title">Monthly Days Supply</h2>
<div class="grid-container" style="overflow-x: auto;">
    <table class="data-grid">
        <thead>
            <tr>
                <th></th>
                {% for m in monthly_data %}
                <th class="align-right">{{ m.month_name[:3] }}</th>
                {% endfor %}
                <th class="align-right total-col">Avg</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Kyger Days</td>
                {% for m in monthly_data %}
                {% set days_class = 'unfavorable' if m.kyger_days_supply < 30 else ('neutral' if m.kyger_days_supply < 50 else 'favorable') %}
                <td class="align-right {{ days_class }}">{{ m.kyger_days_supply|round(0)|int }}</td>
                {% endfor %}
                <td class="align-right total-col">{{ kyger.avg_days_supply|round(0)|int }}</td>
            </tr>
            <tr>
                <td>Clifty Days</td>
                {% for m in monthly_data %}
                {% set days_class = 'unfavorable' if m.clifty_days_supply < 30 else ('neutral' if m.clifty_days_supply < 50 else 'favorable') %}
                <td class="align-right {{ days_class }}">{{ m.clifty_days_supply|round(0)|int }}</td>
                {% endfor %}
                <td class="align-right total-col">{{ clifty.avg_days_supply|round(0)|int }}</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Plant Comparison -->
<h2 class="section-title">Plant Comparison ({{ year }})</h2>
<div class="system-comparison">
    <div class="plant-summary">
        <h3>Kyger Creek</h3>
        <div class="metric-row">
            <span class="metric-label">Total Supply</span>
            <span class="metric-value">{{ "{:,.0f}".format(kyger.total_tons) }} tons</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Total Cost</span>
            <span class="metric-value">${{ "{:,.0f}".format(kyger.total_cost) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Avg $/Ton</span>
            <span class="metric-value">${{ "{:.2f}".format(kyger.avg_cost_per_ton) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Avg Days Supply</span>
            <span class="metric-value">{{ kyger.avg_days_supply|round(0)|int }} days</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Beginning Inv (Jan 1)</span>
            <span class="metric-value">{{ "{:,.0f}".format(kyger.beginning_inventory) }} tons</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Ending Inv (Dec 31)</span>
            <span class="metric-value">{{ "{:,.0f}".format(kyger.ending_inventory) }} tons</span>
        </div>
    </div>
    
    <div class="plant-summary">
        <h3>Clifty Creek</h3>
        <div class="metric-row">
            <span class="metric-label">Total Supply</span>
            <span class="metric-value">{{ "{:,.0f}".format(clifty.total_tons) }} tons</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Total Cost</span>
            <span class="metric-value">${{ "{:,.0f}".format(clifty.total_cost) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Avg $/Ton</span>
            <span class="metric-value">${{ "{:.2f}".format(clifty.avg_cost_per_ton) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Avg Days Supply</span>
            <span class="metric-value">{{ clifty.avg_days_supply|round(0)|int }} days</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Beginning Inv (Jan 1)</span>
            <span class="metric-value">{{ "{:,.0f}".format(clifty.beginning_inventory) }} tons</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Ending Inv (Dec 31)</span>
            <span class="metric-value">{{ "{:,.0f}".format(clifty.ending_inventory) }} tons</span>
        </div>
    </div>
</div>

<!-- Days Supply Legend -->
<div style="margin-top:1rem;display:flex;gap:2rem;color:#6b7280;font-size:0.8rem">
    <div><span style="display:inline-block;padding:0.2rem 0.5rem;border-radius:4px;background:#fef2f2;color:#dc2626;font-size:0.75rem;font-weight:600">Low</span> &lt; 30 days</div>
    <div><span style="display:inline-block;padding:0.2rem 0.5rem;border-radius:4px;background:#fffbeb;color:#d97706;font-size:0.75rem;font-weight:600">Medium</span> 30-49 days</div>
    <div><span style="display:inline-block;padding:0.2rem 0.5rem;border-radius:4px;background:#f0fdf4;color:#16a34a;font-size:0.75rem;font-weight:600">Good</span> 50+ days</div>
</div>
{% endblock %}
