{% extends "base.html" %}

{% block title %}Fuel Costs - {{ plant_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-left">
        <h1>Fuel Cost Summary <span class="subtitle">{{ plant_name }}</span></h1>
    </div>
    <div class="header-right">
        <span class="card-subtext">Year: {{ year }}</span>
    </div>
</div>

<!-- Summary Bar (compact like Budget View) -->
<div class="budget-summary">
    <div class="summary-item highlight">
        <span class="label">Total Fuel Cost</span>
        <span class="value">${{ "{:,.0f}".format(annual.total_fuel_cost) }}</span>
    </div>
    <div class="summary-item highlight">
        <span class="label">$/MWh</span>
        <span class="value">${{ "{:.2f}".format(annual.avg_fuel_cost_per_mwh) }}</span>
    </div>
    <div class="summary-item">
        <span class="label">Coal Consumed</span>
        <span class="value">{{ "{:,.0f}".format(annual.total_coal_tons) }} tons</span>
    </div>
    <div class="summary-item">
        <span class="label">Heat Rate</span>
        <span class="value">{{ "{:,.0f}".format(annual.avg_heat_rate) }} BTU/kWh</span>
    </div>
    <div class="summary-item">
        <span class="label">Total MWh</span>
        <span class="value">{{ "{:,.0f}".format(annual.total_mwh) }}</span>
    </div>
</div>

<!-- Monthly Data Table -->
<h2 class="section-title">Monthly Fuel Costs</h2>
<div class="grid-container" style="overflow-x: auto;">
    <table class="data-grid">
        <thead>
            <tr>
                <th></th>
                {% for m in monthly_data %}
                <th class="align-right">{{ m.month_name[:3] }}</th>
                {% endfor %}
                <th class="align-right total-col">Annual</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Net MWh</td>
                {% for m in monthly_data %}
                <td class="align-right">{{ "{:,.0f}".format(m.net_mwh) }}</td>
                {% endfor %}
                <td class="align-right total-col">{{ "{:,.0f}".format(annual.total_mwh) }}</td>
            </tr>
            <tr>
                <td>Coal Cost</td>
                {% for m in monthly_data %}
                <td class="align-right">${{ "{:,.0f}".format(m.coal_cost) }}</td>
                {% endfor %}
                <td class="align-right total-col">${{ "{:,.0f}".format(annual.total_coal_cost) }}</td>
            </tr>
            <tr>
                <td>Consumables</td>
                {% for m in monthly_data %}
                <td class="align-right">${{ "{:,.0f}".format(m.consumables_cost) }}</td>
                {% endfor %}
                <td class="align-right total-col">${{ "{:,.0f}".format(annual.total_consumables_cost) }}</td>
            </tr>
            <tr>
                <td style="color: #16a34a;">Byproduct Sales</td>
                {% for m in monthly_data %}
                <td class="align-right favorable">+${{ "{:,.0f}".format(-m.byproduct_sales_revenue) }}</td>
                {% endfor %}
                <td class="align-right favorable total-col">+${{ "{:,.0f}".format(-annual.total_byproduct_sales_revenue) }}</td>
            </tr>
            <tr>
                <td style="color: #dc2626;">Byproduct Costs</td>
                {% for m in monthly_data %}
                <td class="align-right unfavorable">${{ "{:,.0f}".format(m.byproduct_disposal_costs + m.byproduct_misc_expense) }}</td>
                {% endfor %}
                <td class="align-right unfavorable total-col">${{ "{:,.0f}".format(annual.total_byproduct_disposal_costs + annual.total_byproduct_misc_expense) }}</td>
            </tr>
            <tr>
                <td>Byproduct Net</td>
                {% for m in monthly_data %}
                <td class="align-right {% if m.byproduct_net < 0 %}favorable{% else %}unfavorable{% endif %}">
                    {% if m.byproduct_net < 0 %}+{% endif %}${{ "{:,.0f}".format(m.byproduct_net|abs) }}
                </td>
                {% endfor %}
                <td class="align-right {% if annual.total_byproduct_net < 0 %}favorable{% else %}unfavorable{% endif %} total-col">
                    {% if annual.total_byproduct_net < 0 %}+{% endif %}${{ "{:,.0f}".format(annual.total_byproduct_net|abs) }}
                </td>
            </tr>
            <tr class="totals-row">
                <td><strong>Total Fuel Cost</strong></td>
                {% for m in monthly_data %}
                <td class="align-right" style="font-weight:600">${{ "{:,.0f}".format(m.total_fuel_cost) }}</td>
                {% endfor %}
                <td class="align-right total-col" style="font-weight:600">${{ "{:,.0f}".format(annual.total_fuel_cost) }}</td>
            </tr>
            <tr>
                <td><strong>$/MWh</strong></td>
                {% for m in monthly_data %}
                <td class="align-right" style="font-weight:600">${{ "{:.2f}".format(m.fuel_cost_per_mwh) }}</td>
                {% endfor %}
                <td class="align-right total-col" style="font-weight:600">${{ "{:.2f}".format(annual.avg_fuel_cost_per_mwh) }}</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- System Comparison -->
<h2 class="section-title">System Comparison ({{ year }})</h2>
<div class="system-comparison">
    <div class="plant-summary">
        <h3>Kyger Creek</h3>
        <div class="metric-row">
            <span class="metric-label">Total MWh</span>
            <span class="metric-value">{{ "{:,.0f}".format(system.kyger.total_mwh) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Coal Consumed</span>
            <span class="metric-value">{{ "{:,.0f}".format(system.kyger.total_coal_tons) }} tons</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Total Fuel Cost</span>
            <span class="metric-value">${{ "{:,.0f}".format(system.kyger.total_fuel_cost) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">$/MWh</span>
            <span class="metric-value">${{ "{:.2f}".format(system.kyger.avg_fuel_cost_per_mwh) }}</span>
        </div>
    </div>
    
    <div class="plant-summary">
        <h3>Clifty Creek</h3>
        <div class="metric-row">
            <span class="metric-label">Total MWh</span>
            <span class="metric-value">{{ "{:,.0f}".format(system.clifty.total_mwh) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Coal Consumed</span>
            <span class="metric-value">{{ "{:,.0f}".format(system.clifty.total_coal_tons) }} tons</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Total Fuel Cost</span>
            <span class="metric-value">${{ "{:,.0f}".format(system.clifty.total_fuel_cost) }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">$/MWh</span>
            <span class="metric-value">${{ "{:.2f}".format(system.clifty.avg_fuel_cost_per_mwh) }}</span>
        </div>
    </div>
</div>

<!-- Cost Breakdown -->
<h2 class="section-title">Annual Cost Breakdown</h2>
<div class="cost-breakdown">
    <div class="cost-item">
        <div class="cost-label">Coal Cost</div>
        <div class="cost-value expense">${{ "{:,.0f}".format(annual.total_coal_cost) }}</div>
    </div>
    <div class="cost-item">
        <div class="cost-label">Consumables</div>
        <div class="cost-value expense">${{ "{:,.0f}".format(annual.total_consumables_cost) }}</div>
    </div>
    <div class="cost-item">
        <div class="cost-label">Byproducts (Net)</div>
        <div class="cost-value {% if annual.total_byproduct_net < 0 %}revenue{% else %}expense{% endif %}">
            {% if annual.total_byproduct_net < 0 %}
            +${{ "{:,.0f}".format(-annual.total_byproduct_net) }}
            {% else %}
            ${{ "{:,.0f}".format(annual.total_byproduct_net) }}
            {% endif %}
        </div>
    </div>
</div>

<!-- Byproduct Detail -->
<h2 class="section-title">Byproduct Breakdown</h2>
<div class="cost-breakdown" style="grid-template-columns: repeat(4, 1fr);">
    <div class="cost-item">
        <div class="cost-label">Sales Revenue</div>
        <div class="cost-value revenue">+${{ "{:,.0f}".format(-annual.total_byproduct_sales_revenue) }}</div>
        <div class="cost-detail">Gypsum &amp; ash sales</div>
    </div>
    <div class="cost-item">
        <div class="cost-label">Disposal Costs</div>
        <div class="cost-value expense">${{ "{:,.0f}".format(annual.total_byproduct_disposal_costs) }}</div>
        <div class="cost-detail">Ash &amp; gypsum disposal</div>
    </div>
    <div class="cost-item">
        <div class="cost-label">Misc Expense</div>
        <div class="cost-value expense">${{ "{:,.0f}".format(annual.total_byproduct_misc_expense) }}</div>
        <div class="cost-detail">Fixed monthly costs</div>
    </div>
    <div class="cost-item">
        <div class="cost-label">Net</div>
        <div class="cost-value {% if annual.total_byproduct_net < 0 %}revenue{% else %}expense{% endif %}">
            {% if annual.total_byproduct_net < 0 %}
            +${{ "{:,.0f}".format(-annual.total_byproduct_net) }}
            {% else %}
            ${{ "{:,.0f}".format(annual.total_byproduct_net) }}
            {% endif %}
        </div>
        <div class="cost-detail">Revenue - Costs</div>
    </div>
</div>
{% endblock %}
