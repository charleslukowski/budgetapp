{% extends "base.html" %}

{% block title %}Compare Scenarios - OVEC{% endblock %}

{% block content %}
<link rel="stylesheet" href="/static/styles.css">

<style>
.compare-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 24px;
}

.compare-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.compare-header h1 {
    margin: 0;
    font-size: 28px;
    color: #1e3a5f;
}

.scenario-selectors {
    display: flex;
    gap: 16px;
}

.scenario-selector {
    padding: 12px;
    background: white;
    border-radius: 8px;
    border: 2px solid #e5e7eb;
    min-width: 250px;
}

.scenario-selector.active {
    border-color: #2d6a4f;
}

.scenario-selector label {
    display: block;
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.scenario-selector select {
    width: 100%;
    padding: 8px;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    font-size: 14px;
}

.compare-grid {
    display: grid;
    grid-template-columns: 200px 1fr 1fr 150px;
    gap: 0;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.compare-row {
    display: contents;
}

.compare-cell {
    padding: 12px 16px;
    border-bottom: 1px solid #e5e7eb;
    font-size: 14px;
}

.compare-cell.header {
    background: linear-gradient(135deg, #1e3a5f 0%, #2d4a6f 100%);
    color: white;
    font-weight: 600;
    padding: 16px;
}

.compare-cell.metric-name {
    background: #f8fafc;
    font-weight: 500;
    color: #374151;
}

.compare-cell.value {
    text-align: right;
    font-family: 'SF Mono', 'Consolas', monospace;
}

.compare-cell.value.scenario-a {
    background: rgba(16, 185, 129, 0.05);
}

.compare-cell.value.scenario-b {
    background: rgba(59, 130, 246, 0.05);
}

.compare-cell.delta {
    text-align: right;
    font-weight: 600;
}

.compare-cell.delta.positive {
    color: #dc2626;
    background: rgba(220, 38, 38, 0.05);
}

.compare-cell.delta.negative {
    color: #10b981;
    background: rgba(16, 185, 129, 0.05);
}

.compare-cell.delta.neutral {
    color: #6b7280;
}

.section-header {
    grid-column: 1 / -1;
    background: linear-gradient(135deg, #f0f4f8 0%, #e8eef5 100%);
    padding: 12px 16px;
    font-weight: 600;
    font-size: 15px;
    color: #1e3a5f;
    border-top: 2px solid #e5e7eb;
}

.empty-state {
    grid-column: 1 / -1;
    padding: 60px 24px;
    text-align: center;
    color: #6b7280;
}

.empty-state h3 {
    margin: 0 0 8px 0;
    color: #374151;
}

.legend {
    display: flex;
    gap: 24px;
    margin-top: 24px;
    padding: 16px;
    background: #f8fafc;
    border-radius: 8px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #6b7280;
}

.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.legend-dot.green {
    background: #10b981;
}

.legend-dot.blue {
    background: #3b82f6;
}

.compare-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}
</style>

<div class="compare-container">
    <div class="compare-header">
        <h1>Compare Scenarios</h1>
        
        <div class="scenario-selectors">
            <div class="scenario-selector active">
                <label>Base Scenario</label>
                <select id="scenario-a-select" onchange="updateComparison()">
                    <option value="">Select a scenario...</option>
                    {% for s in scenarios %}
                    <option value="{{ s.id }}" {% if s.id == scenario_a_id %}selected{% endif %}>
                        {{ s.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="scenario-selector">
                <label>Compare To</label>
                <select id="scenario-b-select" onchange="updateComparison()">
                    <option value="">Select a scenario...</option>
                    {% for s in scenarios %}
                    <option value="{{ s.id }}" {% if s.id == scenario_b_id %}selected{% endif %}>
                        {{ s.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    
    <div class="compare-grid" id="compare-grid">
        <div class="compare-row">
            <div class="compare-cell header">Metric</div>
            <div class="compare-cell header">{{ scenario_a.name if scenario_a else "Base Scenario" }}</div>
            <div class="compare-cell header">{{ scenario_b.name if scenario_b else "Comparison" }}</div>
            <div class="compare-cell header">Difference</div>
        </div>
        
        {% if comparison %}
        <!-- Use Factors Section -->
        <div class="section-header">Use Factors</div>
        
        {% set uf_kc_diff = comparison.summary.get('avg_use_factor_kc', {}) %}
        {% set uf_cc_diff = comparison.summary.get('avg_use_factor_cc', {}) %}
        <div class="compare-row">
            <div class="compare-cell metric-name">Kyger Creek Average</div>
            <div class="compare-cell value scenario-a">{{ "%.1f"|format((scenario_a.summary.avg_use_factor_kc or 0) * 100) }}%</div>
            <div class="compare-cell value scenario-b">{{ "%.1f"|format((scenario_b.summary.avg_use_factor_kc or 0) * 100) }}%</div>
            <div class="compare-cell delta {% if (uf_kc_diff.get('delta') or 0) > 0 %}positive{% elif (uf_kc_diff.get('delta') or 0) < 0 %}negative{% else %}neutral{% endif %}">
                {% if uf_kc_diff %}{{ "{:+.1f}".format((uf_kc_diff.get('delta') or 0) * 100) }}%{% else %}—{% endif %}
            </div>
        </div>
        
        <div class="compare-row">
            <div class="compare-cell metric-name">Clifty Creek Average</div>
            <div class="compare-cell value scenario-a">{{ "%.1f"|format((scenario_a.summary.avg_use_factor_cc or 0) * 100) }}%</div>
            <div class="compare-cell value scenario-b">{{ "%.1f"|format((scenario_b.summary.avg_use_factor_cc or 0) * 100) }}%</div>
            <div class="compare-cell delta {% if (uf_cc_diff.get('delta') or 0) > 0 %}positive{% elif (uf_cc_diff.get('delta') or 0) < 0 %}negative{% else %}neutral{% endif %}">
                {% if uf_cc_diff %}{{ "{:+.1f}".format((uf_cc_diff.get('delta') or 0) * 100) }}%{% else %}—{% endif %}
            </div>
        </div>
        
        <!-- Heat Rates Section -->
        <div class="section-header">Heat Rates</div>
        
        {% set hr_kc_diff = comparison.summary.get('avg_heat_rate_kc', {}) %}
        {% set hr_cc_diff = comparison.summary.get('avg_heat_rate_cc', {}) %}
        <div class="compare-row">
            <div class="compare-cell metric-name">Kyger Creek Baseline</div>
            <div class="compare-cell value scenario-a">{{ "{:,.0f}".format(scenario_a.summary.avg_heat_rate_kc or 0) }} BTU/kWh</div>
            <div class="compare-cell value scenario-b">{{ "{:,.0f}".format(scenario_b.summary.avg_heat_rate_kc or 0) }} BTU/kWh</div>
            <div class="compare-cell delta {% if (hr_kc_diff.get('delta') or 0) > 0 %}positive{% elif (hr_kc_diff.get('delta') or 0) < 0 %}negative{% else %}neutral{% endif %}">
                {% if hr_kc_diff %}{{ "{:+,.0f}".format(hr_kc_diff.get('delta') or 0) }}{% else %}—{% endif %}
            </div>
        </div>
        
        <div class="compare-row">
            <div class="compare-cell metric-name">Clifty Creek Baseline</div>
            <div class="compare-cell value scenario-a">{{ "{:,.0f}".format(scenario_a.summary.avg_heat_rate_cc or 0) }} BTU/kWh</div>
            <div class="compare-cell value scenario-b">{{ "{:,.0f}".format(scenario_b.summary.avg_heat_rate_cc or 0) }} BTU/kWh</div>
            <div class="compare-cell delta {% if (hr_cc_diff.get('delta') or 0) > 0 %}positive{% elif (hr_cc_diff.get('delta') or 0) < 0 %}negative{% else %}neutral{% endif %}">
                {% if hr_cc_diff %}{{ "{:+,.0f}".format(hr_cc_diff.get('delta') or 0) }}{% else %}—{% endif %}
            </div>
        </div>
        
        <!-- Outages Section -->
        <div class="section-header">Planned Outages</div>
        
        {% set out_kc_diff = comparison.summary.get('total_outage_days_kc', {}) %}
        {% set out_cc_diff = comparison.summary.get('total_outage_days_cc', {}) %}
        <div class="compare-row">
            <div class="compare-cell metric-name">Kyger Creek Total Days</div>
            <div class="compare-cell value scenario-a">{{ "{:,.0f}".format(scenario_a.summary.total_outage_days_kc or 0) }}</div>
            <div class="compare-cell value scenario-b">{{ "{:,.0f}".format(scenario_b.summary.total_outage_days_kc or 0) }}</div>
            <div class="compare-cell delta {% if (out_kc_diff.get('delta') or 0) > 0 %}positive{% elif (out_kc_diff.get('delta') or 0) < 0 %}negative{% else %}neutral{% endif %}">
                {% if out_kc_diff %}{{ "{:+,.0f}".format(out_kc_diff.get('delta') or 0) }}{% else %}—{% endif %}
            </div>
        </div>
        
        <div class="compare-row">
            <div class="compare-cell metric-name">Clifty Creek Total Days</div>
            <div class="compare-cell value scenario-a">{{ "{:,.0f}".format(scenario_a.summary.total_outage_days_cc or 0) }}</div>
            <div class="compare-cell value scenario-b">{{ "{:,.0f}".format(scenario_b.summary.total_outage_days_cc or 0) }}</div>
            <div class="compare-cell delta {% if (out_cc_diff.get('delta') or 0) > 0 %}positive{% elif (out_cc_diff.get('delta') or 0) < 0 %}negative{% else %}neutral{% endif %}">
                {% if out_cc_diff %}{{ "{:+,.0f}".format(out_cc_diff.get('delta') or 0) }}{% else %}—{% endif %}
            </div>
        </div>
        
        <!-- Coal Pricing Section -->
        <div class="section-header">Coal Pricing</div>
        
        {% set coal_diff = comparison.summary.get('avg_coal_price', {}) %}
        <div class="compare-row">
            <div class="compare-cell metric-name">Average Delivered Cost</div>
            <div class="compare-cell value scenario-a">${{ "%.2f"|format(scenario_a.summary.avg_coal_price or 0) }}/ton</div>
            <div class="compare-cell value scenario-b">${{ "%.2f"|format(scenario_b.summary.avg_coal_price or 0) }}/ton</div>
            <div class="compare-cell delta {% if (coal_diff.get('delta') or 0) > 0 %}positive{% elif (coal_diff.get('delta') or 0) < 0 %}negative{% else %}neutral{% endif %}">
                {% if coal_diff %}${{ "{:+.2f}".format(coal_diff.get('delta') or 0) }}{% else %}—{% endif %}
            </div>
        </div>
        
        {% else %}
        <div class="empty-state">
            <h3>Select Scenarios to Compare</h3>
            <p>Choose a base scenario and a comparison scenario from the dropdowns above.</p>
        </div>
        {% endif %}
    </div>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-dot green"></div>
            <span>Green = Favorable change (lower cost/usage)</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #dc2626;"></div>
            <span>Red = Unfavorable change (higher cost/usage)</span>
        </div>
    </div>
    
    <div class="compare-actions">
        <a href="/scenarios" class="btn btn-secondary">← Back to Scenarios</a>
        {% if comparison %}
        <button class="btn btn-primary" onclick="exportComparison()">
            Export Comparison
        </button>
        {% endif %}
    </div>
</div>

<script>
function updateComparison() {
    const scenarioA = document.getElementById('scenario-a-select').value;
    const scenarioB = document.getElementById('scenario-b-select').value;
    
    if (scenarioA && scenarioB) {
        window.location.href = `/scenarios/compare?a=${scenarioA}&b=${scenarioB}`;
    }
}

function exportComparison() {
    const scenarioA = document.getElementById('scenario-a-select').value;
    const scenarioB = document.getElementById('scenario-b-select').value;
    
    if (scenarioA && scenarioB) {
        window.location.href = `/api/scenarios/compare/${scenarioA}/${scenarioB}/export`;
    }
}
</script>
{% endblock %}

